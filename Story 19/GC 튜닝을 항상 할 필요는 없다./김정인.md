# 내용정리

---

- GC 튜닝은 기본적인 메모리 크기 정도만 지정하면 왠만큼 사용량이 많지 않은 시스템에서는 튜닝을 할 필요가 없다.
- 기본적인 옵션이 지정되어 있는 것이 필요하다.
  - -Xms 옵션과 -Xmx 옵션으로 메모리 크기를 지정했다.
  - -server 옵션이 포함되어 있다.
- 시스템의 로그에는 타임아웃 관련 로그가 남아있지 않아야 한다.
  - DB 작업과 관련된 타임아웃
  - 다른 서버와의 통신시 타임아웃

<br />

### GC 튜닝의 전제조건
- JVM의 메모리 크기도 지정하지 않았다.
- Timeout 이 지속적으로 발생하고 있다.
- GC 튜닝은 가장 마지막에 하는 것이다.

<br />

### GC 튜닝을 하는 근본적인 이유
- Java 에서 생성된 객체는 가비지 컬렉터(GC) 가 처리해서 지운다.
- 생성된 객체가 많으면 많을수록 GC가 처리해야 하는 대상도 많아지고, GC를 수행하는 횟수도 증가한다.

<br />

### GC 튜닝의 목적
- Old 영역으로 넘어가는 객체의 수를 최소화 하는 것
  - Eden 영역에서 객체가 처음 만들어지고, Survivor 영역을 오가다가, 끝까지 남아 있는 객체를 Old 영역으로 이동한다. 
- Full GC의 실행 시간을 줄이는 것
  - Old 영역의 크기를 줄이면 OutOfMemoryError 가 발생하거나 Full GC 횟수가 늘어난다.
  - Old 영역의 크기를 늘리면 Full GC 횟수는 줄어들지만 실행 시간이 늘어난다.


<br />

### GC 의 성능을 결정하는 옵션들

| 구분           |옵션|설명
|--------------|---|---|
| 힙(heap)영역 크기 |-Xms|JVM 시작시 힙 영역 크기|
| -            |-Xmx|최대 힙 영역 크기|
|New 영역의 크기|-XX:NewRatio|New영역과 Old 영역의 비율|
|-|-XX:NewSize|New 영역의 크기|
|-|-XX:SurvivorRatio|Eden 영역과 Survivor 영역의 비율|


### GC 튜닝의 절차
- GC 상황 모니터링
  - GC 상황을 모니터링하며 현재 운영되는 시스템의 GC 상황을 확인해야 한다.
- 모니터링 결과 분석 후 GC 튜닝 여부 결정
  - 결과를 분석하고 GC 튜닝 여부를 결정해야 한다.
- GC 방식/메모리 크기 지정
- 결과 분석 및 GC 옵션 변경
- 전체 서버에 반영

### 힙 덤프
- 현재 Java 메모리에 어떤 객체와 어떤 데이터가 있는지 확인하기 위한 메모리의 단면 파일이다.
- 이 파일은 JDK에 포함되어 있는 jmap 이라는 명령으로 생성할 수 있다.
- 파일을 생성하는 도중에는 Java 프로세스가 멈추기 때문에 시스템을 운영하고 있을 때는 이 파일을 생성하면 안된다.



