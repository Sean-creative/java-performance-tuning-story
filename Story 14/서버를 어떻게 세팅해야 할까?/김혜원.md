
## 웹 기반 시스템에서 성능에 영향을 줄말한 세팅

 - 웹 서버 세팅

 - WAS 서버 세팅

 - DB서버 세팅

 - 장비 세팅

## 웹 서버 세팅

 - 웹 서버는 반드시 WAS 앞에 두어야 함

 - WAS 웹에서 사용하는 애플리케이션 서버이지 웹 서버가 아님. 정적인 부분은 웹 서버에서 처리해야 함

 - 아파치 웹 서버는 MPM이라는 것을 사용하며 MPM(Multi-Processing Module)은 여러개의 프로세싱 모듈 기반의 서비스를 제공한다는 의미이다. 

 - 가장 쉽게 아파치 웹 서버의 설정을 바꾸는 방법은 httpd.conf 파일을 수정하는 것 

 - ThreadPerChild : 웹 서버가 사용하는 스레드의 개수를 지정

 - MaxRequestsPerChild : 최대 요청 개수 0일 경우, 그 수에 제한을 두지 않겠다를 의미  

 - Include conf/extra/httpd-mpm.conf부분 주석 해제시 httpd-mpm.conf를 통해서 세밀한 스레드 설정 지정할 수 있게된다. 

 - 스레드 부분을 사용하기 위해서는 worker부분을 수정해 주어야 하는데

    StartServers : 서버를 띄울 때 프로세스의 개수를 지정. 보통 이야기하는 Child의 수

    MaxClients : 최대 처리 가능한 클라이언트의 수를 지정

MinSpareThreads : 최소 여유 스레드 수를 지정

MaxSpareThreads : 최대 여유 스레드 수를 지정

ThreadsPerChild : 프로세스당 스레드 수를 지정

MaxRequestsPerChild 

## 웹 서버의 Keep Alive 

 - keepAlive on : 웹 서버와 웹 브라우저가 연결이 되었을때 켜져 있지 않으면 매번 HTTP 끊겼다 맺었다 반복

 - 켜져있으면 두 개 정도의 연결을 열어서 끊지 않고, 연결을 계속 재사용. 연결을 하기 위한 대기 시간이 짧아지기 때문에 사용자가 느끼는 응답 속도 엄청 빨라짐.

 - keepAliveTimeout : 마지막 연결이 끝난 이후에 다음 연결이 될 때까지 얼마나 기다릴지를 지정

 - 사용자가 너무 많아 접속이 잘 안될 경우, 이 설정을 5초 정도로 짧게 주는 것도 서버의 리소스를 보다 효율적으로 사용할 수 있는 방법임.

 - 사용자의 접근이 많은 사이트에서는 이미지, css와 같이 정적인 파일들을 웹 서버에서 처리하지 않고, CDN이라고 하는 서비스를 사용. 

 - 무조건 옵션을 켜는게 좋은게 아니니 상황에 맞게 사용

## DB Connection Pool 및 스레드 개수 설정

 - DB Connection Pool의 개수를 최소치, 증가치, 최대치 등으로 자세하게 지정할 수 있음. 

 - 스레드의 개수가 DB 연결 개수보다 많아야하는 이유 : 콘솔 등을 통해 DB에 접속할 수 있기때문에 여유분을 두는게 일반적임.

 - wait time 대기시간 설정

## WAS 인스턴스 개수 설정 

 - 보통은 1~2개의 CPU당 하나의 인스턴스를 지정하는 것이 좋지만, 성능 테스트를 통해서 구하는 것이 바람직하다. 

 - 단독 인스턴스를 구성하여 사용하는 것은 서버에 예기치 못한 상황이 발생했을때 서비스가 불가능해지므로 되도록 피해야 한다.

  - 장비가 한 대여도, 두 개 이상의 인스턴스가 서로 클러스터링하도록 지정하여 사용자의 세션 정보를 공유하도록 하는 것이 좋다. 

## Session Timeout 시간 설정

 - WEB-INF web.xml 파일에서 설정. 서블릿 스펙에 정의된 표준 설정 값

 - 세션 종료 시간 설정 값은 분 단위로 설정되어 있는 분만큼 요청이 없으면 세션을 메모리에서 제거 

 -WAS에서 따로 설정한 바가 없거나 세션 객체의 invalidate() 메서드가 수행되지 않으면 세션은 삭제되지 않음.
 
