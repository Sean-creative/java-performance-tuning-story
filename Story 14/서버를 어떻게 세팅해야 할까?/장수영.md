### 설정해야 하는 대상

---

- 웹 기반의 시스템에서 성능에 영향을 줄만한 세팅
    - 웹 서버 세팅
    - WAS 서버 세팅
    - DB 서버 세팅
    - 장비 세팅
    

### 아파치 웹 서버의 설정

---

- WAS를 웹 서버로 사용하면 안 된다.
    - 웹서버는 반드시 WAS 앞에 둬야 함 → 정적인 부분은 웹서버에서 처리해야 함
    - 반드시 상용 웹 서버나 아파치 웹 서버를 WAS 앞 단에 두고 운영하자
- 아파치 웹 서버에서 성능에 영향을 줄 수 있는 세팅
    - MPM
        - 아파치 웹 서버에서 사용
        - 여러개의 프로세싱 모듈 기반의 서비스를 제공한다는 의미
    - conf/httpd.conf 파일
        
        ```
        ThreadsPerChild 250 // 웹서버가 사용하는 스레드의 개수 지정
        MaxRequestPerChild 0 // 최대 요청 개수를 지정하는 부분, 0이면 제한 X
        ```
        
    - conf/extra/httpd-mpm.conf
        
        ```
        <IfModule mpm_worker_module>
        StartServers 2 // 서버를 띄울 때 프로세스의 개수를 지정한다. child 프로세스의 개수
        MaxClients 150 // 최대 처리 가능한 클라이언트 수 지정
        MinSpareThreads 25 // 최소 여유 스레드 수 지정
        MaxSpareThreads 75 // 최대 여유 스레드 수 지정
        ThreadsPerChild 25 // 프로세스 당 스레드 수 지정
        MaxRequestsPerChild 0 // 최대 요청 개수 지정하는 부분
        </IfModule>
        ```
        
        - 프로세스 수 : 2
        - 프로세스 당 스레드 수 : 25
        - 기본적으로 50개의 요청 처리 가능
        - 최대 여유 스레드 : 75
        - 최대 가능 클라이언트 수 : 150
        - 이 서버는 150명이 최대 → 150명 이상의 요청은 서버 리소스에 여유가 있어도 처리를 안한다.
- 사용자가 늘어나거나 was가 멈추면 어떤 상황이 될까
    - was가 응답하지 않을 때 backlog 설정 값 이상의 요청은 503을 받게 됨 → 이런 값을 받지 않으려면
        - 서버를 늘린다.
        - 서비스를 튜닝한다
        - GC 튜닝을 한다
        - 각종 옵션 값을 튜닝한다

### 웹 서버의 Keep Alive

---

- 웹 서버와 웹 브라우저가 연결이 되었을 때 KeepAlive 기능이 켜져 있지 않으면, 매번 HTTP 연결을 맺었다 끊었다 하는 작업을 반복한다.
- keepAlive 기능이 켜져 있으면 두 개 정도의 연결을 열어서 끊지 않고, 연결을 계속 재사용한다. ⇒ 연결을 하기 위한 대기시간이 짧아짐 → 사용자가 느끼는 응답 속도가 빨라짐
- keepAlive 설정을 할 때 반드시 같이 해야하는 설정
    - KeepAlive-Timeout설정
        - 초 단위로 KeepAlive가 끊기는 시간을 설정하기 위한 부분
        

### DB Connection Pool 및 스레드 개수 설정

---

- DB Connection Pool과 스레드 개수는 많이 사용할 수 록 메모리를 많이 점유하게 된다.
    - 그렇다고 메모리를 위해서 DB connection pool과 스레드 개수를 적게 지정하면, 서버에서는 많은 요청을 처리하지 못하고 대기할 수 밖에 없다.
- DB Connection Pool 개수
    - 운영 중에는 최소 및 최대 값을 동일하게 하는 것이 좋다.
    - 사용자 수가 갑자기 증가하면 DB Connection Pool의 개수도 증가되어야 하고, 증가할 때 대기 시간이 발생할 확률이 크기 때문
- 대부분 WAS에서 두 설정 값의 기본 개수가 10~20개 정도이다.
    - DB Connection Pool은 보통 40~50개로 지정하며, 스레드 개수는 50~60개 정도 더 지정한다
    - 스레드 개수가 DB Connection Pool의 개수보다 적으면 적은 수만큼의 연결은 필요없기 때문
    - 스레드 개수가 DB Connection Pool 개수보다 많아야 하는 이유?
        - 모든 애플리케이션이나 화면이 DB에 접속하는 것은 아님, 관리자 콘솔을 사용하여 서버에 접속할 수도 있기 때문에 그만큼 여유분을 갖도록 지정하는 것
- 대기시간과 관련된 값
    - DB Connection Pool의 개수를 넘어 섰을 때 남는 Connection 을 기다리는 시간이 대기시간이다.
    

### WAS 인스턴스 개수 설정

---

### Session Timeout 시간 설정

---

- 세션 종료 시간 설정 값은 분 단위
- 설정 되어있는 분만큼 요청이 없으면 세션을 메모리에서 제거한다.
- 설정을 하지 않은 상태에서 was에서 따로 설정한 바가 없거나 세션 객체의 invalidate()메서드가 수행되지 않으면 세션은 삭제되지 않으므로 유의하자.
