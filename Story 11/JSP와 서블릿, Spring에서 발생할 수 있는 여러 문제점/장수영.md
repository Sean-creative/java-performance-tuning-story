# 11. JSP와 서블릿, Spring에서 발생할 수 있는 여러 문제점

### JSP와 Servlet의 기본적인 동작 원리는 꼭 알아야 한다

---

- JSP의 라이프 사이클
    - JSP URL 호출 → 페이지 번역 → JSP 페이지 컴파일 → 클래스 로드 → 인스턴스 생성 → jspInit 메서드 호출 → _jspService 메서드 호출 → jspDestroy 메서드 호출
    - JSP의 경우 가장 처음에 호출되는 경우에만 시간이 소요되고, 그 이후의 시간에는 컴파일된 서블릿 클래스가 수행된다.
    - 서버의 종류에 따라서 서버가 기동될 때 컴파일을 미리 수행하는 pre-compile 옵션이 있지만, 개발시에 켜놓으면 서버기동 할 때마다 컴파일돼서 시간이 오래 걸린다.
- 서블릿의 라이프 사이클
    - WAS의 JVM이 시작한 후에 → Servlet 객체가 자동으로 생성되고 초기화 되거나, 사용자가 해당 Servlet을 처음으로 호출했을 때 생성되고 초기화된다.
    - 서블릿은 JVM에 여러 객체로 생성되지 않는다.
        - was가 시작하고 사용가능 상태가 된 이상 대부분의 서블릿은 JVM에 살아있고, 여러 스레드에서 해당 서블릿의 service() 메서드를 호출하여 공유한다.
        - 즉 서블릿 객체는 싱글톤으로 관리하므로 서블릿 클래스의 메서드 내에서 선언한 지역변수가 아닌 멤버변수를 선언하여 service 메서드에서 사용하면 → 해당 변수를 여러 스레드에서 접근하면서 계속 값이 변경될 것이다 → 그러므로 service() 메서드를 구현할 때는 멤버변수나 static한 클래스 변수를 선언해서 지속적으로 변경하는 작업은 지양하자.
        

### 적절한 include 사용하기

---

- include 기능을 사용하면 하나의 JSP에서 다른 JSP를 호출하여 여러 JSP 파일을 혼합해서 하나의 JSP로 만들 수 있다.
- JSP에서 사용할 수 있는 include방식
    - 정적인 방식
        - JSP의 라이프 사이클 중 JSP 페이지 번역 및 컴파일 단계에서 필요한 JSP를 읽어서 메인 JSP의 자바 소스 및 클래스에 포함을 시키는 방식
    - 동적인 방식
        - 페이지가 호출될 때마다 지정된 페이지를 불러들여서 수행하도록 되어있다.
- 정적인 방식은 동적방식보다 빠르지만, 추가된 JSP와 메인 JSP에 동일한 이름의 변수가 있으면 오류를 발생시킬 수 도 있으므로 상황에 맞는 include 방식을 선택해서 사용하는 것이 좋다.

### 자바 빈즈, 잘 쓰면 약 못 쓰면 독

---

- java beans는 UI에서 서버 측 데이터를 담아서 처리하기 위한 컴포넌트
- java beans의 문제점
    - 자바빈즈 개수가 많아지면 JSP에서 소요되는 시간이 증가되므로 성능에 영향을 주게 된다.
    

### 태그 라이브러리도 잘 써야 한다

---

### 스프링 프레임워크 간단 정리

---

- 스프링 핵심기술
    - DI, AOP, Portable Service Abstraction

### 스프링 프레임워크를 사용하면서 발생할 수 있는 문제점들

---

- 프록시
    - 스프링을 사용할 때 성능 문제가 가장 많이 발생하는 부분
    - 스프링 프록시는 기본적으로 실행 시에 생성되므로 요청량이 많은 운영에서 문제가 나타날 수 있다.
    - 스프링에서 프록시를 사용하는 경우
        - `@Transactional` 어노테이션을 사용하면 해당 어노테이션을 사용한 클래스의 인스턴스를 처음 만들 때 프록시 객체를 만든다.
        - AOP를 사용해서 별도의 기능을 추가하는 경우도 프록시를 사용한다.
- 스프링이 내부 매커니즘에서 사용하는 캐시도 조심해서 사용해야한다.
    - 스프링에서 제공하는 ViewResolver 중에 자주 사용되는 InternalResourceViewResolver에는 캐싱 기능이 내장되어 있다.
    - 매번 다른 문자열이 생성될 가능성이 높고, 상당히 많은 수의 키 값으로 캐시값이 생성될 수 있는 상황에서는 문자열 반환이 메모리에 치명적일 수 있다 → 이런 상황에서는 뷰 이름을 문자열로 반환하기보다는 뷰 객체 자체를 반환하는 방법이 메모리 릭을 방지하는 데 도움이 된다.
